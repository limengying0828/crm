<!DOCTYPE html>
<!--suppress ALL-->
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>新增合同</title>
    <link rel="stylesheet" href="../../../layui/css/layui.css">
    <script src="../../../js/jquery-3.4.1.js"></script>
    <script src="../../../layui/layui.js"></script>
</head>
<script type="text/javascript">
    goback=function () {
        window.close();
    }
    refresh=function () {
        window.location.href="";
    }
</script>
<body>
<form class="layui-form" action="" method="post">
    <center>
        <table width="80%">
            <tr>
                <td width="20%"><font size="5">新增合同</font></td>
                <td width="20%"></td>
                <td width="20%"></td>
                <td width="20%" align="right">
                    <button type="button" class="layui-btn layui-btn-primary" onclick="goback()"><i class="layui-icon layui-icon-return">返回</i></button>
                    <button type="button" class="layui-btn layui-btn-primary" onclick="refresh()"><i class="layui-icon layui-icon-refresh">刷新</i></button>
                </td>
            </tr>
            <tr>
                <td>合同名称</td>
                <td>
                    <div class="layui-form-item" align="center">
                        <div class="layui-input-block">
                            <input type="text" name="contactperson" id="contactperson" required lay-verify="" placeholder="请输入"
                                   autocomplete="off" class="layui-input">
                        </div>
                    </div>
                </td>
            </tr>
            <tr>
                <td height="20px"></td>
                <td></td>
                <td></td>
                <td></td>
            </tr>
            <tr bgcolor="#fafad2">
                <td height="50px"><h2>客户信息</h2></td>
                <td></td>
                <td></td>
                <td></td>
            </tr>
            <tr>
                <td height="5px"></td>
                <td></td>
                <td></td>
                <td></td>
            </tr>
            <tr>
                <td>客户名称</td>
                <td>
                    <div class="layui-form-item" align="center">
                        <div class="layui-input-block">
                            <input type="text" name="customername" id="customername" required lay-verify="customername" placeholder="请输入"
                                   autocomplete="off" class="layui-input" onchange="customerChange()">
                        </div>
                    </div>
                </td>
                <td>所属行业</td>
                <td>
                    <div class="layui-form-item">
                        <div class="layui-input-block">
                            <select id="industry" name="industry" lay-verify="industry" lay-filter="industry">
                                <option value="">请选择</option>
                            </select>
                        </div>
                    </div>
                </td>
            </tr>

            <tr>
                <td>所在城市</td>
                <td>
                    <div class="layui-form-item" align="center">
                        <div class="layui-input-block">
                            <input type="text" name="city" id="city" required lay-verify="" placeholder="请输入"
                                   autocomplete="off" class="layui-input">
                        </div>
                    </div>
                </td>
                <td>详细地址</td>
                <td align="right">
                    <div class="layui-form-item" align="center">
                        <div class="layui-input-block">
                            <input type="text" name="address" id="address" required lay-verify="" placeholder="请输入"
                                   autocomplete="off" class="layui-input">
                        </div>
                    </div>
                </td>
            </tr>

            <tr bgcolor="#fafad2">
                <td height="50px"><h2>合同信息</h2></td>
                <td></td>
                <td></td>
                <td></td>
            </tr>
            <tr>
                <td height="5px"></td>
                <td></td>
                <td></td>
                <td></td>
            </tr>
            <tr>
                <td>合同名称</td>
                <td>
                    <div class="layui-form-item" align="center">
                        <div class="layui-input-block">
                            <input type="text" name="contactperson" id="contactperson" required lay-verify="" placeholder="请输入"
                                   autocomplete="off" class="layui-input">
                        </div>
                    </div>
                </td>
                <td align="center">合同编号</td>
                <td align="right">
                    <div class="layui-form-item" align="center">
                        <div class="layui-input-block">
                            <input type="text" name="contactperson" id="contactperson" required lay-verify="" placeholder="请输入"
                                   autocomplete="off" class="layui-input">
                        </div>
                    </div>
                </td>
            </tr>

            <tr>
                <td>合同金额</td>
                <td>
                    <div class="layui-form-item" align="center">
                        <div class="layui-input-block">
                            <input type="text" name="contactperson" id="contactperson" required lay-verify="" placeholder="请输入"
                                   autocomplete="off" class="layui-input">
                        </div>
                    </div>
                </td>
                <td align="center">签约日期</td>
                <td align="right">
                    <div class="layui-form">
                        <div class="layui-form-item">
                            <div class="layui-inline">
                                <div class="layui-input-inline">
                                    <input type="date" class="layui-input" id="begintime" name="begintime" placeholder="yyyy-MM-dd" lay-key="1">
                                </div>
                            </div>
                        </div>
                    </div>
                </td>
            </tr>

            <tr>
                <td>生效日期</td>
                <td>
                    <div class="layui-form">
                        <div class="layui-form-item">
                            <div class="layui-inline">
                                <div class="layui-input-inline">
                                    <input type="date" class="layui-input" id="begintime" name="begintime" placeholder="yyyy-MM-dd" lay-key="1">
                                </div>
                            </div>
                        </div>
                    </div>
                </td>
                <td align="center">服务器至</td>
                <td align="right">
                    <div class="layui-form">
                        <div class="layui-form-item">
                            <div class="layui-inline">
                                <div class="layui-input-inline">
                                    <input type="date" class="layui-input" id="begintime" name="begintime" placeholder="yyyy-MM-dd" lay-key="1">
                                </div>
                            </div>
                        </div>
                    </div>
                </td>
            </tr>

            <tr>
                <td>*对方联系人</td>
                <td>
                    <div class="layui-form-item">
                        <div class="layui-input-block">
                            <input type="text" name="email" id="email" required lay-verify="" placeholder="请输入"
                                   autocomplete="off" class="layui-input">
                        </div>
                    </div>
                </td>
                <td align="center">固定电话</td>
                <td align="right">
                    <div class="layui-form-item" align="center">
                        <div class="layui-input-block">
                            <input type="text" name="contactperson" id="contactperson" required lay-verify="" placeholder="请输入"
                                   autocomplete="off" class="layui-input">
                        </div>
                    </div>
                </td>
            </tr>

            <tr>
                <td>移动电话</td>
                <td>
                    <div class="layui-form-item" align="center">
                        <div class="layui-input-block">
                            <input type="text" name="contactperson" id="contactperson" required lay-verify="" placeholder="请输入"
                                   autocomplete="off" class="layui-input">
                        </div>
                    </div>
                </td>
                <td align="center">邮件/QQ</td>
                <td align="right">
                    <div class="layui-form-item" align="center">
                        <div class="layui-input-block">
                            <input type="text" name="contactperson" id="contactperson" required lay-verify="" placeholder="请输入"
                                   autocomplete="off" class="layui-input">
                        </div>
                    </div>
                </td>
            </tr>

            <tr>
                <td>主要技术条款</td>
                <td colspan="3">
                    <div align="center" class="layui-form-item">
                        <div class="layui-input-block">
                            <textarea name="servicescontent" class="layui-input" required="" placeholder="请输入" autocomplete="off" lay-verify="">                            </textarea>
                        </div>
                    </div>
                </td>
            </tr>
            <tr>
                <td>主要商务条款</td>
                <td colspan="3">
                    <div align="center" class="layui-form-item">
                        <div class="layui-input-block">
                            <textarea name="customerfeedback" class="layui-input" required="" placeholder="请输入" autocomplete="off" lay-verify="">                            </textarea>
                        </div>
                    </div>
                </td>
            </tr>
            <tr>
                <td>相关附件</td>
                <td>
                    <div class="layui-upload">
                        <button type="button" class="layui-btn" id="card"><i class="layui-icon layui-icon-upload-drag"></i>上传图片</i></button>
                        <div class="layui-upload-list">
                            <label class="layui-form-label">预览附件</label>
                            <img class="layui-upload-img" id="idcard" style="width: 100px;height: 100px;">
                        </div>
                    </div>
                    <input type="hidden" name="attachment" id="attachment" lay-verify="photo">
                </td>
            </tr>

            <tr>
                <td>合同所属部门</td>
                <td>
                    <div class="layui-form-item" align="center">
                        <div class="layui-input-block">
                            <input type="text" name="contactperson" id="contactperson" required lay-verify="" placeholder="请输入"
                                   autocomplete="off" class="layui-input">
                        </div>
                    </div>
                </td>
                <td align="center">关联人员</td>
                <td align="right">
                    <div class="layui-form-item" align="center">
                        <div class="layui-input-block">
                            <input type="text" name="contactperson" id="contactperson" required lay-verify="" placeholder="请输入"
                                   autocomplete="off" class="layui-input">
                        </div>
                    </div>
                </td>
            </tr>

            <tr>
                <td height="20px"></td>
                <td></td>
                <td></td>
                <td></td>
            </tr>
            <tr bgcolor="#fafad2">
                <td height="50px"><h2>处理流程日志</h2></td>
                <td></td>
                <td></td>
                <td></td>
            </tr>
        </table><br><br>
        <div class="site-text">
            <div style="width:1250px;">
                <div style="float: left">
                    <div class="layui-input-block" style="border:1px solid ;color: #e2e2e2;height:480px;width:400px;">
                        <div>
                            <font size="3" color="black">【处理流程】</font><br/>
                            ----------------------------------------------------------------------
                        </div>
                        <a href="#"><font style="color: blue">&nbsp;&nbsp;&nbsp;&nbsp;哈哈哈哈哈</font></a>
                    </div>
                </div>
                <div style="float: left">
                    <div class="layui-form-item layui-form-text" style="margin-left: 160px;">
                        <div class="layui-input-block" style="border:1px solid ;color: #e2e2e2;height:220px;width: 400px;">
                            <div>
                                <font size="3" color="black">【父事务】</font><br/>
                                ----------------------------------------------------------------------
                            </div>
                            <a href="#"><font style="color: blue">&nbsp;&nbsp;&nbsp;&nbsp;哈哈哈哈哈</font></a>
                        </div>
                    </div>
                    <div class="layui-form-item layui-form-text" style="margin-left: 160px; margin-top: 20px;">
                        <div class="layui-input-block" style="border:1px solid ;color: #e2e2e2;height:220px;width: 400px;">
                            <div>
                                <font size="3" color="black">【子事务】</font><br/>
                                ----------------------------------------------------------------------
                            </div>
                            <a href="#"><font style="color: blue">&nbsp;&nbsp;&nbsp;&nbsp;哈哈哈哈哈</font></a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="layui-form-item" style="width: 80%;margin-left: 20px;">
            <div class="layui-input-block">
                <p>
                    <button class="layui-btn layui-btn-radius layui-btn-primary" lay-submit lay-filter="formDemo">保存</button>
                    <button type="button" class="layui-btn layui-btn-radius layui-btn-primary">提交主管审核</button>
                    <button type="button" class="layui-btn layui-btn-radius layui-btn-primary" lay-submit lay-filter="serviceOver" formmethod="get">组织多人评审</button>
                    <button type="button" class="layui-btn layui-btn-radius layui-btn-primary" lay-submit lay-filter="serviceOver" formmethod="get">登记完成转执行</button>
                    <button type="button" class="layui-btn layui-btn-radius layui-btn-primary" onclick="goback()">取消</button>
                </p>
            </div>
        </div>
    </center>

</form>
<script>
    layui.use(['form', 'layer', 'upload', 'laydate','jquery'], function () {
        var form = layui.form;
        var layer = layui.layer;
        var upload = layui.upload;
        var $=layui.jquery;
        var laydate = layui.laydate;



        form.on('input(customername)', function(data){
            $.ajax({
                type:'get',
                url: '/customer/queryAllByName.do?customername='+data.value,
                datatype: 'json',
                success:function(cus){
                    $("#customername").val(cus.customername);
                    $("#industry").val(cus.industry);
                    $("#city").val(cus.city);
                    $("#address").val(cus.address);
                }
            });
        })


        //普通图片上传
        var uploadInst = upload.render({
            elem: '#card'
            ,url: '/aftersale/upload.do' //改成您自己的上传接口
            ,before: function(obj){
                //预读本地文件示例，不支持ie8
                obj.preview(function(index, file, result){
                    $('#idcard').attr('src', result); //图片链接（base64）
                });
            }
            ,done: function(res){
                //如果上传失败
                if(res.code == 0){
                    $("#attachment").val(res.data)
                    layer.msg('上传成功', {icon: 6});
                }else{
                    layer.msg('上传失败', {icon: 5});
                }
            }
        });

        form.on('submit(formDemo)', function(data){
            $.ajax({
                type: 'post',
                url: '/aftersale/addAfterSale.do', // ajax请求路径
                data: data.field,
                success: function(res){
                    if(res=='yes'){
                        layer.msg('添加成功');
                        location.href="aftersale.html"
                    }else if(data=='no'){
                        layer.msg('添加失败');
                    }
                }
            });
            return false;//禁止跳转，否则会提交两次，且页面会刷新
        });


        form.verify({
            theme: function(value, item) { //value：表单的值、item：表单的DOM对象
                if(value.trim().length==0 ||null==value){
                    return '请填写主题';
                }
            }
            ,customername:function (value, item) {
                if(value.trim().length==0 || null==value){
                    return '请选择客户名称';
                }
            }
            ,contractid:function (value, item) {
                if(value.trim().length==0 || null==value){
                    return '请选择合同编号';
                }
            }

        });


    });
</script>
</body>
</html>